<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guess the Job - Interview Game</title>
    
    <!-- 1. Import Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Nunito:wght@400;600&display=swap" rel="stylesheet">
    
    <!-- 2. Custom Styles based on the Design Brief -->
    <style>
        /* == DESIGN BRIEF VARIABLES == */
        :root {
            --primary-300: #F9C97A;
            --primary-500: #F4A329;
            --primary-700: #B45309;
            --secondary-300: #7EDAD6;
            --secondary-500: #2BB6B4;
            --secondary-700: #0F766E;
            --accent-300: #F49DB8;
            --accent-500: #E8467B;
            --accent-700: #A61E4D;
            --bg: #FFF7F2;
            --surface: #FFFFFF;
            --surface-alt: #F5F7FA;
            --border: #E6E9EF;
            --text: #1F2937;
            --text-2: #4B5563;
            --text-muted: #6B7280;
            --text-inverse: #FFFFFF;
            --success: #2F9E44;
            --warning: #F59F00;
            --error: #D92D20;
            --info: #2563EB;
            
            --font-main: "Inter", "Nunito", system-ui, sans-serif;
            --radius-card: 16px;
            --radius-pill: 9999px;
            --shadow-card: 0 4px 14px rgba(17, 24, 39, 0.08);
            --transition: 180ms ease;
        }

        /* == GLOBAL STYLES == */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: var(--font-main);
            background-color: var(--bg);
            color: var(--text);
            font-size: 16px;
            line-height: 1.5;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 16px;
        }
        h1, h2, h3, h4, h5, h6 {
            font-weight: 600;
            color: var(--text);
        }
        h1 { font-size: 32px; }
        h2 { font-size: 24px; }
        h3 { font-size: 20px; }

        /* == APP LAYOUT == */
        .app-container {
            width: 100%;
            max-width: 440px; /* Reduced for a friendlier, phone-like feel */
            height: 90vh;
            max-height: 720px;
            background-color: var(--surface);
            border-radius: var(--radius-card);
            box-shadow: var(--shadow-card);
            border: 1px solid var(--border);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .app-header {
            background-color: var(--secondary-500);
            color: var(--text-inverse);
            padding: 16px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .app-header h1 {
            color: var(--text-inverse);
            font-size: 24px; /* Slightly smaller for mobile */
        }
        .app-header p {
            color: var(--text-inverse);
            opacity: 0.9;
            font-size: 14px;
        }
        .page-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
        }
        .page-container.hidden {
            display: none;
        }
        .guessing-page {
            padding: 24px;
            text-align: center;
        }

        /* == CHAT STYLES == */
        .chat-history {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            background-color: var(--surface-alt);
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .chat-bubble {
            max-width: 75%;
            padding: 12px 16px;
            border-radius: var(--radius-card);
            margin-bottom: 8px;
            line-height: 1.4;
        }
        .chat-bubble-user {
            background-color: var(--secondary-500);
            color: var(--text-inverse);
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }
        .chat-bubble-persona {
            background-color: var(--surface);
            color: var(--text-2);
            align-self: flex-start;
            border: 1px solid var(--border);
            border-bottom-left-radius: 4px;
        }

        /* NEW STYLE for system messages */
        .chat-bubble-system {
            background-color: var(--surface-alt);
            color: var(--secondary-700);
            font-style: italic;
            font-size: 14px;
            text-align: center;
            padding: 10px 16px;
            border-radius: var(--radius-pill);
            margin: 4px auto; /* Center it */
            max-width: 90%;
            width: fit-content;
        }

        /* == QUESTION LIST STYLES == */
        .question-list-container {
            height: 200px; /* More space for questions */
            padding: 16px;
            background-color: var(--surface);
            border-top: 1px solid var(--border);
            overflow-y: auto;
        }
        .question-list-container h3 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-2);
            margin-bottom: 12px;
        }
        .question-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .question-btn {
            width: 100%;
            text-align: left;
            padding: 12px;
            border-radius: 8px; /* Slightly less rounded than cards */
            font-size: 14px;
            font-family: var(--font-main);
            transition: var(--transition);
            cursor: pointer;
            border: 1px solid var(--primary-300);
            background-color: transparent;
            color: var(--primary-700);
        }
        .question-btn:not(:disabled):hover {
            background-color: rgba(249, 201, 122, 0.2); /* --primary-300 with opacity */
        }
        .question-btn:focus-visible {
            outline: 2px solid var(--secondary-500);
            outline-offset: 2px;
        }
        .question-btn.used {
            background-color: var(--surface-alt);
            border-color: var(--border);
            color: var(--text-muted);
            cursor: not-allowed;
            text-decoration: line-through;
        }
        
        /* == BUTTON STYLES == */
        .btn {
            font-family: var(--font-main);
            width: 100%;
            font-weight: 600;
            font-size: 16px;
            padding: 12px 16px;
            border-radius: var(--radius-pill);
            border: none;
            cursor: pointer;
            transition: var(--transition);
            outline: none;
        }
        .btn:focus-visible {
            outline: 2px solid var(--secondary-500);
            outline-offset: 2px;
        }
        .btn-primary {
            background-color: var(--primary-700);
            color: var(--text-inverse);
        }
        .btn-primary:hover {
            filter: brightness(95%);
        }
        .btn-secondary {
            background-color: transparent;
            color: var(--primary-700);
            border: 2px solid var(--primary-300);
        }
        .btn-secondary:hover {
            background-color: rgba(249, 201, 122, 0.2); /* --primary-300/24% */
        }
        .btn-success {
            background-color: var(--success);
            color: var(--text-inverse);
        }
        .btn-success:hover {
            filter: brightness(95%);
        }
        .ready-guess-container {
            padding: 16px;
            border-top: 1px solid var(--border);
            background-color: var(--surface);
        }

        /* == GUESSING PAGE STYLES == */
        #job-options {
            flex: 1;
            overflow-y: auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            padding: 16px 0;
        }
        .btn-guess-option {
            background-color: var(--secondary-500);
            color: var(--text-inverse);
            border-radius: var(--radius-card);
            padding: 20px 12px;
            font-size: 16px;
            font-weight: 600;
            line-height: 1.3;
            border: none;
            cursor: pointer;
            transition: var(--transition);
        }
        .btn-guess-option:hover {
            filter: brightness(95%);
            box-shadow: var(--shadow-card);
            transform: translateY(-2px);
        }
        .btn-guess-option:focus-visible {
            outline: 2px solid var(--primary-500);
            outline-offset: 2px;
        }
        .guessing-page .btn-secondary {
            margin-top: 16px;
            background-color: var(--surface);
            border-color: var(--text-muted);
            color: var(--text-muted);
        }
        .guessing-page .btn-secondary:hover {
            background-color: var(--surface-alt);
        }

        /* == MODAL & CONFETTI == */
        .modal-overlay {
            position: fixed; /* Use fixed to cover viewport */
            inset: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 24px;
            z-index: 50;
        }
        .modal-overlay.hidden {
            display: none;
        }
        .modal-content.card {
            background-color: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-card);
            box-shadow: var(--shadow-card);
            padding: 32px;
            text-align: center;
            position: relative;
            overflow: hidden;
            width: 100%;
            max-width: 400px;
        }
        .modal-content h2 {
            color: var(--success);
            font-size: 32px;
            margin-bottom: 12px;
        }
        .modal-content p {
            color: var(--text-2);
            font-size: 18px;
            margin-bottom: 4px;
        }
        .modal-content #correct-job-reveal {
            color: var(--secondary-700);
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 24px;
        }
        .confetti-container {
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 60;
        }
        .confetti {
            width: 10px;
            height: 10px;
            background-color: #f00;
            position: absolute;
            opacity: 0;
            animation: confetti-fall 4s linear forwards;
        }
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body>

    <!-- Main App Container -->
    <div class="app-container">

        <!-- ============================================= -->
        <!-- == INTERVIEW PAGE (Visible by default)      == -->
        <!-- ============================================= -->
        <div id="interview-page" class="page-container">
            <!-- Header -->
            <header class="app-header">
                <h1>Guess the Job!</h1>
                <p>Ask questions to guess the person's job.</p>
            </header>

            <!-- Chat History -->
            <div id="chat-history" class="chat-history">
                <!-- Initial Welcome Message -->
                <div class="chat-bubble chat-bubble-persona">
                    Hello! I'm ready for your questions. Ask me anything about my day.
                </div>
                <!-- Chat messages will be added here by JS -->
            </div>

            <!-- "I'm Ready to Guess" Button -->
            <div class="ready-guess-container">
                <button id="show-guess-page-btn" class="btn btn-primary">
                    I'm Ready to Guess!
                </button>
            </div>

            <!-- Question List -->
            <div class="question-list-container">
                <h3>Choose a question to ask:</h3>
                <div id="question-list" class="question-list">
                    <!-- Questions will be populated here by JS -->
                </div>
            </div>
        </div>

        <!-- ============================================= -->
        <!-- == GUESSING PAGE (Hidden by default)        == -->
        <!-- ============================================= -->
        <div id="guessing-page" class="page-container guessing-page hidden">
            <h2>What is my job?</h2>
            <div id="job-options">
                <!-- Job options will be populated here by JS -->
            </div>
            <button id="back-to-interview-btn" class="btn btn-secondary">
                Go back... I need to ask more questions.
            </button>
        </div>

        <!-- ============================================= -->
        <!-- == SUCCESS MODAL (Hidden by default)        == -->
        <!-- ============================================= -->
        <div id="success-modal" class="modal-overlay hidden">
            <div class="modal-content card">
                <!-- Confetti container -->
                <div id="confetti-container" class="confetti-container"></div>
                <h2>You got it!</h2>
                <p>My job is...</p>
                <p id="correct-job-reveal"></p>
                <button id="play-again-btn" class="btn btn-primary">
                    Play Again!
                </button>
            </div>
        </div>
        
    </div>

    <script>
        // ========================================================================
        //  DATABASE (All Jobs, Questions, and Answers)
        // ========================================================================

        const ALL_JOBS = [
            "Doctor", "Firefighter", "Farmer", "Teacher", "Chef", 
            "Pilot", "Police Officer", "Artist", "Scientist", "Bus Driver"
        ];

        // --- MODIFIED: ALL_QUESTIONS is now an array of objects ---
        // We've added a 'tier' to each question.
        const ALL_QUESTIONS = [
            // Tier 1: General, broad questions
            { text: "What time do you get up?", tier: 1 },
            { text: "Do you work inside?", tier: 1 },
            { text: "Do you work outside?", tier: 1 },
            { text: "Do you work with people?", tier: 1 },
            { text: "Do you work at night?", tier: 1 },
            { text: "Do you use a computer?", tier: 1 },
            { text: "Do you get dirty at work?", tier: 1 },
            { text: "What time do you finish work?", tier: 1 },
            { text: "Do you like your job?", tier: 1 },

            // Tier 2: More specific, narrowing questions
            { text: "Do you wear a uniform?", tier: 2 },
            { text: "Do you work with animals?", tier: 2 },
            { text: "Do you work with food?", tier: 2 },
            { text: "Do you help people?", tier: 2 },
            { text: "Is your job dangerous?", tier: 2 },
            { text: "Do you work with children?", tier: 2 },
            { text: "Do you make things?", tier: 2 },
            { text: "Do you travel for work?", tier: 2 },

            // Tier 3: "Giveaway" or "Confirmation" questions
            { text: "Do you work in a hospital?", tier: 3 },
            { text: "Do you work in a school?", tier: 3 },
            { text: "Do you use a big vehicle?", tier: 3 }
        ];

        // This is the "database" of answers
        // It maps the Job Name to an array of answers.
        // The index of the answer corresponds to the index of the question in ALL_QUESTIONS.
        // --- THIS ENTIRE OBJECT has been rewritten and re-indexed ---
        const ANSWERS_DB = {
            "Doctor": [
                "I get up very early, around 6 AM.", // 0. Get up? (T1)
                "Yes, I work inside almost all day.", // 1. Inside? (T1)
                "No, I am almost always inside.", // 2. Outside? (T1)
                "Yes, I work with many people every day.", // 3. People? (T1)
                "Sometimes, yes. My job can be 24 hours.", // 4. Night? (T1)
                "Yes, I use a computer quite a lot.", // 5. Computer? (T1)
                "No, my work is usually very clean.", // 6. Dirty? (T1)
                "I often finish work very late.", // 7. Finish? (T1)
                "Yes, I find it very rewarding.", // 8. Like job? (T1)
                "Yes, I wear a special white coat.", // 9. Uniform? (T2)
                "No, I do not work with animals.", // 10. Animals? (T2)
                "No, I do not work with food.", // 11. Food? (T2)
                "Yes, I help people who are sick.", // 12. Help people? (T2)
                "It can be. Sometimes people are very sick.", // 13. Dangerous? (T2)
                "Yes, I work with children and adults.", // 14. Children? (T2)
                "No, I help people get better.", // 15. Make things? (T2)
                "No, I stay in one building.", // 16. Travel? (T2)
                "Yes, I work in a hospital.", // 17. Hospital? (T3)
                "No, I do not.", // 18. School? (T3)
                "Sometimes I ride in an ambulance, but I don't drive." // 19. Vehicle? (T3)
            ],
            "Firefighter": [
                "My schedule is not regular. Sometimes I am awake all night.", // 0. Get up? (T1)
                "Sometimes. I wait inside a building.", // 1. Inside? (T1)
                "Yes, I work outside a lot, in all weather.", // 2. Outside? (T1)
                "Yes, I work very closely with a team.", // 3. People? (T1)
                "Yes, I often work at night.", // 4. Night? (T1)
                "No, not very much.", // 5. Computer? (T1)
                "Yes, I get very dirty.", // 6. Dirty? (T1)
                "My work is never really finished!", // 7. Finish? (T1)
                "Yes, it is a very important job.", // 8. Like job? (T1)
                "Yes, I wear a very heavy uniform and a helmet.", // 9. Uniform? (T2)
                "Sometimes I rescue cats from trees!", // 10. Animals? (T2)
                "No, but I cook dinner with my team at the station.", // 11. Food? (T2)
                "Yes, I help people who are in trouble.", // 12. Help people? (T2)
                "Yes, my job is very dangerous.", // 13. Dangerous? (T2)
                "Sometimes I rescue children.", // 14. Children? (T2)
                "No, I stop bad things from happening.", // 15. Make things? (T2)
                "No, I only work in my city.", // 16. Travel? (T2)
                "No, but I take people to the hospital.", // 17. Hospital? (T3)
                "No, but I visit schools to talk about safety.", // 18. School? (T3)
                "Yes, I use a very big, red truck with a ladder." // 19. Vehicle? (T3)
            ],
            "Farmer": [
                "I get up very, very early, before the sun.", // 0. Get up? (T1)
                "Sometimes, but I am outside most of the day.", // 1. Inside? (T1)
                "Yes, I work outside in the sun and rain.", // 2. Outside? (T1)
                "Not many. I am usually alone.", // 3. People? (T1)
                "No, I finish work when the sun goes down.", // 4. Night? (T1)
                "Sometimes, to check the weather.", // 5. Computer? (T1)
                "Yes, I get very dirty with mud.", // 6. Dirty? (T1)
                "I finish in the evening, when it is dark.", // 7. Finish? (T1)
                "Yes, I love working with nature.", // 8. Like job? (T1)
                "No, I wear old clothes and boots.", // 9. Uniform? (T2)
                "Yes, I work with many animals, like cows and chickens.", // 10. Animals? (T2)
                "Yes, I grow food for people to eat.", // 11. Food? (T2)
                "Yes, I help people by giving them food.", // 12. Help people? (T2)
                "No, but the work is very hard.", // 13. Dangerous? (T2)
                "No, I work with plants and animals.", // 14. Children? (T2)
                "I help make food grow from the ground.", // 15. Make things? (T2)
                "No, I stay on my land.", // 16. Travel? (T2)
                "No, I do not.", // 17. Hospital? (T3)
                "No, I do not.", // 18. School? (T3)
                "Yes, I use a big green tractor." // 19. Vehicle? (T3)
            ],
            "Teacher": [
                "I get up at 7 AM to go to work.", // 0. Get up? (T1)
                "Yes, I work inside a big room.", // 1. Inside? (T1)
                "Only sometimes, for a break.", // 2. Outside? (T1)
                "Yes, I work with many people every day.", // 3. People? (T1)
                "No, I only work during the day.", // 4. Night? (T1)
                "Yes, I use a computer and a big white board.", // 5. Computer? (T1)
                "Sometimes I get paint or glue on my hands!", // 6. Dirty? (T1)
                "I finish in the afternoon, around 4 PM.", // 7. Finish? (T1)
                "Yes, I love my job very much!", // 8. Like job? (T1)
                "No, I just wear nice, clean clothes.", // 9. Uniform? (T2)
                "No, but sometimes we have a class pet, like a hamster.", // 10. Animals? (T2)
                "No, but I eat lunch with many people.", // 11. Food? (T2)
                "Yes, I help people learn new things.", // 12. Help people? (T2)
                "No, my job is very safe.", // 13. Dangerous? (T2)
                "Yes, I work with children all day.", // 14. Children? (T2)
                "No, I help children make things.", // 15. Make things? (T2)
                "No, I stay in one building.", // 16. Travel? (T2)
                "No, I do not.", // 17. Hospital? (T3)
                "Yes, I work in a school.", // 18. School? (T3)
                "No, I do not use a vehicle." // 19. Vehicle? (T3)
            ],
            "Chef": [
                "I get up in the afternoon.", // 0. Get up? (T1)
                "Yes, I work inside a very hot room.", // 1. Inside? (T1)
                "No, I am always inside.", // 2. Outside? (T1)
                "Yes, I work with a team.", // 3. People? (T1)
                "Yes, I work every night, even on weekends.", // 4. Night? (T1)
                "No, not very much.", // 5. Computer? (T1)
                "Yes, I get dirty with sauces and flour.", // 6. Dirty? (T1)
                "I finish very late at night, around 11 PM.", // 7. Finish? (T1)
                "Yes, I love to cook!", // 8. Like job? (T1)
                "Yes, I wear a tall white hat and a white jacket.", // 9. Uniform? (T2)
                "No, but I cook meat and fish.", // 10. Animals? (T2)
                "Yes, I work with food all day!", // 11. Food? (T2)
                "Yes, I help people by making them happy with good food.", // 12. Help people? (T2)
                "It can be! Fire and knives are dangerous.", // 13. Dangerous? (T2)
                "No, I work with adults.", // 14. Children? (T2)
                "Yes, I make delicious meals.", // 15. Make things? (T2)
                "No, I stay in my kitchen.", // 16. Travel? (T2)
                "No, I do not.", // 17. Hospital? (T3)
                "No, I do not.", // 18. School? (T3)
                "No, I do not." // 19. Vehicle? (T3)
            ],
            "Pilot": [
                "My get up time is different every day.", // 0. Get up? (T1)
                "Yes, I work inside a small room.", // 1. Inside? (T1)
                "No, I am always inside... but I move fast!", // 2. Outside? (T1)
                "Yes, I work with one other person.", // 3. People? (T1)
                "Yes, I often work at night.", // 4. Night? (T1)
                "Yes, I use many computers and buttons.", // 5. Computer? (T1)
                "No, my work is very clean.", // 6. Dirty? (T1)
                "My finish time is different every day.", // 7. Finish? (T1)
                "Yes, I love to see the world.", // 8. Like job? (T1)
                "Yes, I wear a smart uniform with a hat.", // 9. Uniform? (T2)
                "No, I do not work with animals.", // 10. Animals? (T2)
                "No, but people bring me coffee.", // 11. Food? (T2)
                "Yes, I help people get to new places.", // 12. Help people? (T2)
                "No, it is very safe, but I must be careful.", // 13. Dangerous? (T2)
                "No, I work with adults.", // 14. Children? (T2)
                "No, I do not make things.", // 15. Make things? (T2)
                "Yes, I travel all over the world for my work.", // 16. Travel? (T2)
                "No, I do not.", // 17. Hospital? (T3)
                "No, I do not.", // 18. School? (T3)
                "Yes, I use a very big, white vehicle with wings." // 19. Vehicle? (T3)
            ],
            "Police Officer": [
                "My get up time changes. Sometimes day, sometimes night.", // 0. Get up? (T1)
                "Sometimes I am inside, at a desk.", // 1. Inside? (T1)
                "Yes, I am outside a lot, walking or driving.", // 2. Outside? (T1)
                "Yes, I work with many people and a partner.", // 3. People? (T1)
                "Yes, I often work at night.", // 4. Night? (T1)
                "Yes, I use a computer.", // 5. Computer? (T1)
                "No, I try to stay clean and neat.", // 6. Dirty? (T1)
                "I finish after 8 or 10 hours.", // 7. Finish? (T1)
                "Yes, it is a difficult but good job.", // 8. Like job? (T1)
                "Yes, I wear a blue uniform and a heavy belt.", // 9. Uniform? (T2)
                "Sometimes, I work with a special dog.", // 10. Animals? (T2)
                "No, I do not work with food.", // 11. Food? (T2)
                "Yes, my job is to help and protect people.", // 12. Help people? (T2)
                "Yes, my job can be very dangerous.", // 13. Dangerous? (T2)
                "Yes, I help children who are lost.", // 14. Children? (T2)
                "No, I write reports.", // 15. Make things? (T2)
                "No, I only work in my city.", // 16. Travel? (T2)
                "No, but I sometimes go there.", // 17. Hospital? (T3)
                "No, but I visit schools to talk to students.", // 18. School? (T3)
                "Yes, I use a special car with red and blue lights." // 19. Vehicle? (T3)
            ],
            "Artist": [
                "I usually get up late, around 10 AM.", // 0. Get up? (T1)
                "Yes, I work inside a room with big windows.", // 1. Inside? (T1)
                "Sometimes I go outside to get ideas.", // 2. Outside? (T1)
                "No, I work alone most of the time.", // 3. People? (T1)
                "Yes, I often work very late at night.", // 4. Night? (T1)
                "Sometimes I use a computer, sometimes just my hands.", // 5. Computer? (T1)
                "Yes! I get very dirty.", // 6. Dirty? (T1)
                "I finish when I am tired, maybe 2 AM!", // 7. Finish? (T1)
                "Yes, I love my job!", // 8. Like job? (T1)
                "No, I wear comfortable, old clothes.", // 9. Uniform? (T2)
                "No, but I like to draw animals.", // 10. Animals? (T2)
                "No, but I drink a lot of coffee!", // 11. Food? (T2)
                "I help people by making beautiful things to look at.", // 12. Help people? (T2)
                "No, my job is very safe.", // 13. Dangerous? (T2)
                "No, I do not work with children.", // 14. Children? (T2)
                "Yes, I make pictures and sculptures.", // 15. Make things? (T2)
                "No, I stay in my studio.", // 16. Travel? (T2)
                "No, I do not.", // 17. Hospital? (T3)
                "No, I do not.", // 18. School? (T3)
                "No, I do not use a vehicle." // 19. Vehicle? (T3)
            ],
            "Scientist": [
                "I get up at 8 AM.", // 0. Get up? (T1)
                "Yes, I work inside a laboratory.", // 1. Inside? (T1)
                "No, I am always inside.", // 2. Outside? (T1)
                "Yes, I work with a team of other smart people.", // 3. People? (T1)
                "Sometimes, if an experiment takes a long time.", // 4. Night? (T1)
                "Yes, I use a computer all day.", // 5. Computer? (T1)
                "No, my work is very clean and careful.", // 6. Dirty? (T1)
                "I finish at 6 PM, usually.", // 7. Finish? (T1)
                "Yes, I love to discover new things.", // 8. Like job? (T1)
                "Yes, I wear a white lab coat and safety glasses.", // 9. Uniform? (T2)
                "Sometimes, I work with mice or plants.", // 10. Animals? (T2)
                "No, I do not work with food.", // 11. Food? (T2)
                "Yes, I help people by finding new information.", // 12. Help people? (T2)
                "Sometimes, I work with chemicals, so I must be careful.", // 13. Dangerous? (T2)
                "No, I work with adults.", // 14. Children? (T2)
                "I make new ideas and new medicines.", // 15. Make things? (T2)
                "Sometimes I travel to talk about my work.", // 16. Travel? (T2)
                "No, but my work can help hospitals.", // 17. Hospital? (T3)
                "No, but I work at a university.", // 18. School? (T3)
                "No, I do not." // 19. Vehicle? (T3)
            ],
            "Bus Driver": [
                "I get up very early, around 4 AM.", // 0. Get up? (T1)
                "Yes, I work inside all day.", // 1. Inside? (T1)
                "No, but I can see outside all day!", // 2. Outside? (T1)
                "Yes, I say 'hello' to many people all day.", // 3. People? (T1)
                "Sometimes I drive the night bus.", // 4. Night? (T1)
                "No, I use a steering wheel.", // 5. Computer? (T1)
                "No, my work is clean.", // 6. Dirty? (T1)
                "I finish in the afternoon.", // 7. Finish? (T1)
                "Yes, I like my job.", // 8. Like job? (T1)
                "Yes, I wear a blue shirt and trousers.", // 9. Uniform? (T2)
                "No, I do not work with animals.", // 10. Animals? (T2)
                "No, I do not work with food.", // 11. Food? (T2)
                "Yes, I help people get to work, school, and home.", // 12. Help people? (T2)
                "No, I am a very careful driver.", // 13. Dangerous? (T2)
                "Yes, I see many children.", // 14. Children? (T2)
                "No, I do not make things.", // 15. Make things? (T2)
                "Yes, I travel all around the city, all day.", // 16. Travel? (T2)
                "No, I do not.", // 17. Hospital? (T3)
                "Yes, I take many people to school.", // 18. School? (T3)
                "Yes, I use a very big, long vehicle." // 19. Vehicle? (T3)
            ]
        };
        
        // ========================================================================
        //  GAME LOGIC
        // ========================================================================

        // --- DOM Elements ---
        const interviewPage = document.getElementById('interview-page');
        const guessingPage = document.getElementById('guessing-page');
        const successModal = document.getElementById('success-modal');
        
        const chatHistory = document.getElementById('chat-history');
        const questionList = document.getElementById('question-list');
        const jobOptions = document.getElementById('job-options');
        
        const showGuessPageBtn = document.getElementById('show-guess-page-btn');
        const backToInterviewBtn = document.getElementById('back-to-interview-btn');
        const playAgainBtn = document.getElementById('play-again-btn');
        
        const correctJobReveal = document.getElementById('correct-job-reveal');
        const confettiContainer = document.getElementById('confetti-container');

        // --- Game State ---
        let currentJobName = "";
        let usedQuestionIndices = [];
        let currentTier = 1; // NEW: Track the current unlocked tier

        // --- Functions ---

        /**
         * Starts a new game.
         * Resets the UI and picks a new random job.
         */
        function startGame() {
            // 1. Reset game state
            usedQuestionIndices = [];
            currentTier = 1; // NEW: Reset tier
            
            // 2. Pick a new random job
            const randomIndex = Math.floor(Math.random() * ALL_JOBS.length);
            currentJobName = ALL_JOBS[randomIndex];
            
            // 3. Reset UI
            chatHistory.innerHTML = `
                <div class="chat-bubble chat-bubble-persona">
                    Hello! I'm ready for your questions. Ask me anything about my day.
                </div>`;
            
            populateQuestions();
            populateJobOptions();
            
            // 4. Show/Hide correct pages
            interviewPage.classList.remove('hidden');
            guessingPage.classList.add('hidden');
            successModal.classList.add('hidden');
            
            // Stop any confetti
            confettiContainer.innerHTML = '';
            
            console.log(`New game started. The job is: ${currentJobName}`); // For testing
        }

        /**
         * Fills the #question-list div with buttons for each question.
         */
        function populateQuestions() {
            questionList.innerHTML = '';
            // --- MODIFIED: Loop through new ALL_QUESTIONS structure ---
            ALL_QUESTIONS.forEach((question, index) => {
                // NEW: Only show questions that are in the current or lower tier
                if (question.tier > currentTier) {
                    return; // Don't show this question yet
                }

                const isUsed = usedQuestionIndices.includes(index);
                
                const questionBtn = document.createElement('button');
                questionBtn.textContent = question.text; // Use question.text
                questionBtn.dataset.index = index;
                // Use new CSS classes from the <style> block
                questionBtn.className = isUsed ? 'question-btn used' : 'question-btn';
                
                if (isUsed) {
                    questionBtn.disabled = true;
                }
                
                questionBtn.addEventListener('click', handleQuestionClick);
                questionList.appendChild(questionBtn);
            });
        }

        /**
         * Fills the #job-options div with buttons for each job.
         */
        function populateJobOptions() {
            jobOptions.innerHTML = '';
            // Shuffle jobs for variety
            const shuffledJobs = [...ALL_JOBS].sort(() => Math.random() - 0.5);
            
            shuffledJobs.forEach(jobName => {
                const jobBtn = document.createElement('button');
                jobBtn.textContent = jobName;
                jobBtn.dataset.job = jobName;
                // Use new CSS class
                jobBtn.className = "btn-guess-option";
                jobBtn.addEventListener('click', handleGuessSubmit);
                jobOptions.appendChild(jobBtn);
            });
        }

        /**
         * Handles when a user clicks a question button.
         */
        function handleQuestionClick(event) {
            const questionIndex = parseInt(event.target.dataset.index);
            const questionText = ALL_QUESTIONS[questionIndex].text; // MODIFIED: Get text from object
            const answerText = ANSWERS_DB[currentJobName][questionIndex];
            
            // 1. Add question to chat
            addChatMessage(questionText, 'user');
            
            // 2. Add answer to chat (with a small delay)
            setTimeout(() => {
                addChatMessage(answerText, 'persona');
            }, 500);
            
            // 3. Mark question as used
            usedQuestionIndices.push(questionIndex);
            
            // 4. Disable the button
            event.target.disabled = true;
            // Use new CSS classes
            event.target.className = 'question-btn used';

            // --- NEW: Tier Unlock Logic ---
            const totalAsked = usedQuestionIndices.length;

            // Unlock Tier 2 after 3 questions
            if (totalAsked === 3 && currentTier === 1) {
                currentTier = 2;
                setTimeout(() => {
                    addChatMessage("You have unlocked more specific questions!", 'system');
                    populateQuestions(); // Re-render the list with new questions
                }, 600);
            }

            // Unlock Tier 3 after 6 questions
            if (totalAsked === 6 && currentTier === 2) {
                currentTier = 3;
                setTimeout(() => {
                    addChatMessage("You have unlocked the final questions!", 'system');
                    populateQuestions(); // Re-render the list with new questions
                }, 600);
            }
        }

        /**
         * Handles when a user clicks a job guess.
         */
        function handleGuessSubmit(event) {
            const guessedJob = event.target.dataset.job;
            
            if (guessedJob === currentJobName) {
                // Correct!
                showSuccess();
            } else {
                // Incorrect
                // Use a less-intrusive alert
                const button = event.target;
                const originalColor = button.style.backgroundColor;
                button.style.backgroundColor = 'var(--error)';
                button.style.color = 'var(--text-inverse)';
                button.textContent = "Try again!";
                
                setTimeout(() => {
                    button.style.backgroundColor = originalColor;
                    button.style.color = 'var(--text-inverse)';
                    button.textContent = guessedJob;
                }, 1000);
            }
        }

        /**
         * Shows the success modal and starts confetti.
         */
        function showSuccess() {
            correctJobReveal.textContent = currentJobName;
            successModal.classList.remove('hidden');
            triggerConfetti();
        }

        /**
         * Simple confetti effect
         */
        function triggerConfetti() {
            confettiContainer.innerHTML = ''; // Clear old confetti
            const colors = ['var(--primary-500)', 'var(--secondary-500)', 'var(--accent-500)', 'var(--success)'];
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                // Use colors from the design brief
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = Math.random() * 100 + '%'; // Use % for responsiveness
                confetti.style.animationDelay = Math.random() * 4 + 's';
                confetti.style.width = (Math.random() * 8 + 6) + 'px';
                confetti.style.height = (Math.random() * 8 + 6) + 'px';
                confetti.style.opacity = Math.random() * 0.5 + 0.5;
                confettiContainer.appendChild(confetti);
            }
        }

        /**
         * Adds a new message bubble to the chat history.
         */
        function addChatMessage(text, role) {
            const messageDiv = document.createElement('div');
            messageDiv.textContent = text;
            // --- MODIFIED: Handle new 'system' role ---
            let roleClass = '';
            if (role === 'user') {
                roleClass = 'chat-bubble-user';
            } else if (role === 'persona') {
                roleClass = 'chat-bubble-persona';
            } else if (role === 'system') {
                roleClass = 'chat-bubble-system';
            }
            
            messageDiv.className = `chat-bubble ${roleClass}`;
            
            chatHistory.appendChild(messageDiv);
            
            // Scroll to bottom
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }
        
        /**
         * Switches view from interview to guessing page.
         */
        function showGuessingPage() {
            interviewPage.classList.add('hidden');
            guessingPage.classList.remove('hidden');
        }

        /**
         * Switches view from guessing page back to interview.
         */
        function showInterviewPage() {
            interviewPage.classList.remove('hidden');
            guessingPage.classList.add('hidden');
        }

        // --- Event Listeners ---
        showGuessPageBtn.addEventListener('click', showGuessingPage);
        backToInterviewBtn.addEventListener('click', showInterviewPage);
        playAgainBtn.addEventListener('click', startGame);

        // --- Initial App Load ---
        startGame();

    </script>
</body>
</html>